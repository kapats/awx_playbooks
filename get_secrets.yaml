---
- name: Get password from SSM
  hosts: localhost
  gather_facts: False
  tasks:
      - name: Get the current caller identity information
        amazon.aws.aws_caller_info:
        register: caller_user_id

      - name: Show caller identity
        debug:
          msg: "The current role is {{ caller_user_id }}"
      - name: get secret
        set_fact:
          secret: "{{ lookup('aws_ssm', '/tests/karol/ansible_secret', region='eu-central-1') }}"

      - name: Display the secret
        hosts: 'awsdemo-ada-001'
        gather_facts: False
        tasks:
          - name: print secret
            debug:
              var: db_password